# ------------------------------------------------------------------
# 1.  Stimulus and phototransduction helpers
# ------------------------------------------------------------------
Stim(t, t_on, t_off, Φ; hold = 0) = (t_on <= t <= t_off ? Φ : hold)

J∞(g, kg) = g^3 / (g^3 + kg^3)                      # CNG gating
C∞(C, Cae, K) = C > Cae ? (C - Cae)/(C - Cae + K) : 0.0   # clamp at 0

# ------------------------------------------------------------------
# 2.  Voltage‑gated K+ (IKv)
# ------------------------------------------------------------------
αmKV(v) =  5*(100 - v) / ( exp((100 - v)/42) - 1 )
βmKV(v) =  9 * exp(-(v - 20)/40)

αhKV(v) = 0.15 * exp(-v/22)
βhKV(v) = 0.4125 / ( exp((10 - v)/7) + 1 )

# ------------------------------------------------------------------
# 3.  L‑type Ca2+ current (ICa)
# ------------------------------------------------------------------
αmCa(v) =  3*(80 - v) / ( exp((80 - v)/25) - 1 )
βmCa(v) = 10 / ( 1 + exp((v + 38)/7) )

hCa(v)  = exp((40 - v)/18) / ( 1 + exp((40 - v)/18) )

# ------------------------------------------------------------------
# 4.  Ca2+‑activated K+ current (IK(Ca))
# ------------------------------------------------------------------
αmKCa(v) = 15*(80 - v) / ( exp((80 - v)/40) - 1 )
βmKCa(v) = 20 * exp(-v/35)

mKCas(C) = C / (C + 0.3)                             # BK Ca‑gate

# ------------------------------------------------------------------
# 5.  Ca2+‑activated Cl− current (ICl(Ca))
# ------------------------------------------------------------------
mCl(C)  = 1 / ( 1 + exp((0.37 - C)/0.09) )           # note 0.09 !

# ------------------------------------------------------------------
# 6.  Hyperpolarisation‑activated current (Ih) – 5‑state matrix
# ------------------------------------------------------------------
αh(v) =  8  / ( exp((v + 78)/14) + 1 )
βh(v) = 18 / ( exp(-(v + 8)/19) + 1 )                # minus‑sign & 8

hT(v)  = [
   -4αh(v)       βh(v)        0        0        0
    4αh(v)  -(3αh(v)+βh(v))  2βh(v)    0        0
      0        3αh(v)  -(2αh(v)+2βh(v)) 3βh(v)   0
      0          0        2αh(v)  -(αh(v)+3βh(v)) 4βh(v)
      0          0          0        αh(v)    -4βh(v)
]
